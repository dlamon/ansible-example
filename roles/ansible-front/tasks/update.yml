---
- name: 删除旧版本
  file:
    path: "{{ deploy_path }}"
    state: absent

- name: 创建部署目录
  file:
    path: "{{ item }}"
    state: directory
  loop:
    - "{{ deploy_path }}/site"
    - "{{ deploy_path }}/conf"
    - "{{ deploy_path }}/cert"

- name: 解压新版本
  unarchive:
    src: "{{ home }}/downloads/{{ deploy_file }}"
    dest: "{{ deploy_path }}/site/"
    copy: no

- name: 上传配置文件
  template:
    src: nginx.conf
    dest: "{{ deploy_path }}/conf/"